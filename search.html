<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pneuma App</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>

</head>

<body>
    <h1 id="title"></h1>




    <div id="flight">
        <label for="from">from:</label>
        <input list="fromlist" id="from" name="from">
        <datalist id="fromlist">

        </datalist>
         <img id="swap" height="40em" src="./Swap.png" />
        <label for="to">Choose to:</label>
        <input list="tolist" id="to" name="to">

        <datalist id="tolist">


        </datalist>
        <label for="class">Choose Class:</label>
        <select  name ="class" id="class">
            <option value="ECONOMY">ECONOMY</option>
            <option value="PREMIUM_ECONOMY">PREMIUM_ECONOMY</option>
            <option value="BUSINESS">BUSINESS</option>
            <option value="FIRST">FIRST</option>
        </select>
        <label for="fromdate">from date:</label>

        <input type="date" id="fromdate" name="fromdate" value="2022-03-12">
        <!-- <label for="todate">to date:</label>
		<input type="date" id="todate" name="todate" value="2021-12-23">
		 -->


        <button id="flight-btn" type="submit">submit</button>

    </div>
    <img id="loading" src="./load.gif" alt="Loading Image">
     <h2 id="noflight">No Flight Found</h2>
    <div id="carddiv">
        <h4>For the Cards you have</h4>

        <table id="table" data-search="true" data-page-list="[10, 25, 50, 100, all]" data-page-size="100"
            data-pagination="true" data-sort-name="numberOfStops" data-sort-order="asc" > 

            <thead>
                <tr>
                    <th data-field="carrierName" data-sortable="true">Airline</th>
                    <th data-field="duration" data-sortable="true">Duration</th>
                    <th data-field="flightcode" data-sortable="true">Flight Number</th>
                    <th data-field="availability" data-sortable="true">Availability</th>
                    <th data-field="departureTime" data-sortable="true">Departure</th>
                    <th data-field="arrivalTime" data-sortable="true">arrival</th>
                    <th data-field="numberOfStops" data-sortable="true" data-sort-order="desc">Stops</th>
                    <th data-field="price" data-sortable="true" data-sort-order="desc">Price</th>
                    <th data-field="Miles" data-sortable="true">Miles</th>
                    <th data-field="cc1" data-sortable="true">Amex Platinum Charge</th>
                    <th data-field="cc2" data-sortable="true">Citi PremierMiles</th>
                    <th data-field="cc3" data-sortable="true">Citi Prestige</th>
                    <th data-field="cc4" data-sortable="true">Air India SBI Signature </th>
                    <th data-field="cc5" data-sortable="true">Citi Rewards</th>
                    <th data-field="cc6" data-sortable="true">HDFC Diners ClubMiles</th>
                    <th data-field="cc7" data-sortable="true">HDFC Infinia</th>
                    <th data-field="cc8" data-sortable="true">Club Vistara SBI PRIME</th>
                    <th data-field="cc9" data-sortable="true">Axis vistara infinite</th>
                    <th data-field="cc10" data-sortable="true">Axis Miles And More</th>
                    <th data-field="partner" data-sortable="true">O/P</th>
                </tr>
            </thead>
        </table>
    </div>

    <div id="fomodiv">
        <h4>For fomo Cards</h4>
        <table id="fomo" data-search="true" data-page-list="[10, 25, 50, 100, all]" data-page-size="100"
            data-pagination="true" data-sort-name="numberOfStops" data-sort-order="asc" >
            <thead>
                <tr>
                    <th data-field="carrierName" data-sortable="true">Airline</th>
                    <th data-field="duration" data-sortable="true">Duration</th>
                    <th data-field="flightcode" data-sortable="true">Flight Number</th>
                    <th data-field="availability" data-sortable="true">Availability</th>
                    <th data-field="departureTime" data-sortable="true">Departure</th>
                    <th data-field="arrivalTime" data-sortable="true">Arrival</th>
                    <th data-field="numberOfStops" data-sortable="true" data-sort-order="desc">Stops</th>
                    <th data-field="price" data-sortable="true" data-sort-order="desc">Price</th>
                    <th data-field="Miles" data-sortable="true">Miles</th>
                    <th data-field="cc1" data-sortable="true">Amex Platinum Charge</th>
                    <th data-field="cc2" data-sortable="true">Citi PremierMiles</th>
                    <th data-field="cc3" data-sortable="true">Citi Prestige</th>
                    <th data-field="cc4" data-sortable="true">Air India SBI Signature </th>
                    <th data-field="cc5" data-sortable="true">Citi Rewards</th>
                    <th data-field="cc6" data-sortable="true">HDFC Diners ClubMiles</th>
                    <th data-field="cc7" data-sortable="true">HDFC Infinia</th>
                    <th data-field="cc8" data-sortable="true">Club Vistara SBI PRIME</th>
                    <th data-field="cc9" data-sortable="true">Axis vistara infinite</th>
                    <th data-field="cc10" data-sortable="true">Axis Miles And More</th>
                    <th data-field="partner" data-sortable="true">O/P</th>
                </tr>
            </thead>
        </table>
    </div>


    <script src="./airportcode.js"></script>
  
    <script >

$(document).ready(function(){
      function pad(num) {
    let a = "";
    console.log(num)
    s = num.toString()
    s.split('-').forEach((pr, p) => {
      d = ("000000000" + pr)
      if (p == 1) { a += '-' }; a += d.substr(d.length - 6);;
    })
    return a;
  }
  function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));}
    if (getParameterByName("name")){
    $("#title").html(`Hi ${getParameterByName("name")}, Search your Flight`)}
    else{$("#title").html(`Hi, Search your Flight`)}
      $("#fomodiv").hide()
      $("#carddiv").hide()
      $("#loading").hide()
      $("#noflight").hide()
      for(var i=1;i<=10;i++){
        if(getParameterByName("cc"+i)){ $('#fomo').bootstrapTable('hideColumn', 'cc'+i)}else{$('#table').bootstrapTable('hideColumn', 'cc'+i)}

      }
    
      // $('#table').bootstrapTable('hideColumn', 'cc1')
      // $('#table').bootstrapTable('hideColumn', 'cc2')
      // $('#table').bootstrapTable('hideColumn', 'cc3')
      // $('#table').bootstrapTable('hideColumn', 'cc4')
      // $('#table').bootstrapTable('hideColumn', 'cc5')

      $("table").bind("DOMSubtreeModified", function() {
        $("tr:contains('operating')").css("background-color", "#ffb3bf")
        $("tr:contains('partner')").css("background-color", "#FAE8E0")
    });
      $("#swap").click(function () {
    console.log("swap")
var from = $("#from").val()
var to = $("#to").val()
$("#from").val(to)
$("#to").val(from)

  })
    $("#flight-btn").click(function(){
      $("#fomodiv").hide()
      $("#carddiv").hide()
      $("#noflight").hide()
      $('#table').bootstrapTable('destroy');
      $('#fomo').bootstrapTable('destroy');
      $("#loading").show()
      console.log("working on request "+`https://pneuma-app.herokuapp.com/api/loyalty?from=${$('#from').val()}&to=${$('#to').val()}&class=${$('#class').val()}&date=${$('#fromdate').val()}`)
      $.get(`https://pneuma-app.herokuapp.com/api/loyalty?from=${$('#from').val().toUpperCase()}&to=${$('#to').val().toUpperCase()}&class=${$('#class').val()}&date=${$('#fromdate').val()}`, function(result, status){
        console.log(result);
        try{
        let ab = result.map(x => {
       if(x['Miles']) x['Miles'] = pad(x['Miles'].toString());
      });
      console.log(ab)
      $('#table').bootstrapTable(
          {
          data:result,
          defaultSorted:{
            dataField: 'numberOfStops',
            order: 'acs'}
          
        });
          $('#fomo').bootstrapTable({
            data:result,
            defaultSorted:{
              dataField: 'numberOfStops',
              order: 'acs'}
            
          });

          $("#loading").hide()
          for(var i=1;i<=10;i++){
            if(getParameterByName("cc"+i)){ $('#fomo').bootstrapTable('hideColumn', 'cc'+i)}else{$('#table').bootstrapTable('hideColumn', 'cc'+i)}
          }
          let fomo=true;
          let card=true;
          for(var i=1;i<=10;i++){
            if(getParameterByName("cc"+i)){card=false}else{fomo=false}}
            $("#fomodiv").show()
            $("#carddiv").show()
            if(card){ $("#carddiv").hide()}
            if(fomo){ $("#fomodiv").hide()}
        }catch{
      $("#loading").hide()
      $("#noflight").show()
    }
          
      });
    });




  });
</script>
</body>

</html>